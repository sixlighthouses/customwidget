System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/Directions","esri/layers/RouteLayer","esri/rest/locator","jimu-core/react","jimu-theme"],(function(e,t){var i={},o={},n={},r={},a={},l={},s={},u={};return{setters:[function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.MutableStoreManager=e.MutableStoreManager,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ServiceManager=e.ServiceManager,i.UtilityManager=e.UtilityManager,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.proxyUtils=e.proxyUtils},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.Alert=e.Alert,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){r.default=e.default},function(e){a.default=e.default},function(e){l.default=e.default},function(e){s.useEffect=e.useEffect},function(e){u.styled=e.styled}],execute:function(){e((()=>{var e={75465:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.414 10 10 1.414 18.586 10 10 18.586zm-.707.707a1 1 0 0 1 0-1.414L9.293.707a1 1 0 0 1 1.414 0l8.586 8.586a1 1 0 0 1 0 1.414l-8.586 8.586a1 1 0 0 1-1.414 0zm14.19-2.041-3.314 3.352a9.065 9.065 0 0 0-.398-1.126l2.918-2.832zM7.71 8H10V7H6v4h1V8.706l1.33 1.325C9.483 11.3 10 11.987 10 14.5v.5h1v-.5c.16-2.227-.537-3.43-1.948-5.16z" clip-rule="evenodd"></path></svg>'},20404:e=>{"use strict";e.exports=a},50724:e=>{"use strict";e.exports=l},35254:e=>{"use strict";e.exports=r},26826:e=>{"use strict";e.exports=o},48891:e=>{"use strict";e.exports=i},51315:e=>{"use strict";e.exports=s},34796:e=>{"use strict";e.exports=u},30726:e=>{"use strict";e.exports=n}},t={};function c(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>L,default:()=>C});var e=c(48891),t=c(26826),i=c(30726),o=c(35254),n=c(20404),r=c(50724);const a={includeDefaultSources:!1,locationEnabled:!1,maxSuggestions:6};function l(e){return`${e}_output_stop`}function s(e){return`${e}_output_direction_point`}function u(e){return`${e}_output_direction_line`}function v(e){return`${e}_output_route`}const g={_widgetLabel:"Directions",_action_DirectionsFrom_label:"Directions From",_action_DirectionsTo_label:"Directions To",outOfCredit:"Cannot load route service. This may be due to the service not being accessible.",namedInvalidUtilMsg:"{label} not available.",namedNeedLoginUtilMsg:"Sorry, you don't have permission to access {label}."};var f=c(75465),p=c.n(f),y=c(51315),m=c(34796);const h=e.UtilityManager.getInstance(),S=m.styled.div`
  display: flex;
  .alert-panel {
    flex: 1;
    margin: 2px;
  }
`;function x(t){const{useUtilities:o}=t,[n,r]=e.React.useState(null),[a,l]=e.React.useState(null),s=e.hooks.useTranslation(g,i.defaultMessages),[u,c]=e.React.useState(!0),[d,v]=e.React.useState(!0),f=e.ReactRedux.useSelector((e=>e.resourceSessions));return(0,y.useEffect)((()=>{!function(){var e,t,i,u;e=this,t=void 0,u=function*(){const e=[],t=[];if(o)for(let i=0;i<o.length;i++){const n=h.getLabelOfUseUtility(o[i]),r=h.getUtilityJson(o[i].utilityId),{success:a,isSignInError:l}=yield h.checkUtilityStatus(r);a||(l?t.push(n):e.push(n))}const i=t.length>0?s("namedNeedLoginUtilMsg",{label:t.join(", ")}):null;i!==a&&l(i);const u=e.length>0?s("namedInvalidUtilMsg",{label:e.join(", ")}):null;u!==n&&r(u)},new((i=void 0)||(i=Promise))((function(o,n){function r(e){try{l(u.next(e))}catch(e){n(e)}}function a(e){try{l(u.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((u=u.apply(e,t||[])).next())}))}()}),[n,a,s,o,f,null==t?void 0:t.useUtilities]),e.React.createElement("div",{className:"util-alert-wrapper d-flex flex-column position-absolute w-100",style:{bottom:0}},n&&e.React.createElement(S,null,e.React.createElement(i.Alert,{closable:!0,form:"basic",onClose:()=>{v(!1)},open:d,text:n,withIcon:!0})),a&&e.React.createElement(S,null,e.React.createElement(i.Alert,{closable:!0,form:"basic",onClose:()=>{c(!1)},open:u,text:a,withIcon:!0})))}var b=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};const{useEffect:M,useState:w,useRef:U,useCallback:_,useMemo:I}=e.React,C=c=>{var d,f;const{config:y,id:m}=c,{searchConfig:h,routeConfig:S}=y,C=null===(d=c.theme)||void 0===d?void 0:d.darkTheme,j=null===(f=c.useMapWidgetIds)||void 0===f?void 0:f[0],[L,k]=w(null),O=U(null),[F,N]=w(Math.random()),V=U(null),J=U(null),W=U(null),H=e.hooks.useTranslation(g,i.defaultMessages),z=I((()=>H("findAddressOrPlace")),[H]),[$,B]=w(!1),G=e.ReactRedux.useSelector((e=>e.resourceSessions)),q=_((e=>{k(e)}),[]),K=_((e=>b(void 0,void 0,void 0,(function*(){const t=h.dataConfig.map((e=>D(e.useUtility))).asMutable().map((t=>b(void 0,void 0,void 0,(function*(){return r.default.locationToAddress(t,{location:e})}))));let i=null;for(const e of t)try{const{address:t}=yield e;if(t){i=t;break}}catch(e){console.error(e)}if(!i){const{address:t}=yield r.default.locationToAddress("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",{location:e});i=t}return i}))),[null==h?void 0:h.dataConfig]),Q=_((()=>b(void 0,void 0,void 0,(function*(){if($&&J.current&&c.mutableStateProps){const{directionsFromPoint:t,directionsToPoint:i}=c.mutableStateProps;if(t){const i=yield K(t);return J.current.layer.stops.at(0).geometry=t,J.current.layer.stops.at(0).name=i,void e.MutableStoreManager.getInstance().updateStateValue(c.widgetId,"directionsFromPoint",null)}if(i){const t=yield K(i),o=J.current.layer.stops.length;return J.current.layer.stops.at(o-1).geometry=i,J.current.layer.stops.at(o-1).name=t,void e.MutableStoreManager.getInstance().updateStateValue(c.widgetId,"directionsToPoint",null)}yield J.current.viewModel.load(),J.current.viewModel.layer.stops.filter((e=>null!==e.geometry)).length>=2&&(yield J.current.viewModel.getDirections())}}))),[K,$,c.mutableStateProps,c.widgetId]);return M((()=>{!function(){var t,i;if(j&&(null==S?void 0:S.useUtility)&&(null===(t=null==h?void 0:h.dataConfig)||void 0===t?void 0:t.length)>0){const t=null===(i=(0,e.getAppStore)().getState().appConfig)||void 0===i?void 0:i.utilities,o=h.dataConfig.some((e=>t[e.useUtility.utilityId])),n=!!(t&&t[S.useUtility.utilityId]&&o);B(!(!S||!n))}else B(!1)}()}),[j,null==S?void 0:S.useUtility,null==h?void 0:h.dataConfig,S,null==c?void 0:c.useUtilities]),M((()=>{Q()})),M((()=>{!function(){var t;b(this,void 0,void 0,(function*(){if(O.current===G||!(null==c?void 0:c.useUtilities))return;const i=O.current;O.current=G;const o=null===(t=null==c?void 0:c.useUtilities)||void 0===t?void 0:t.map((t=>{var i;return null===(i=e.UtilityManager.getInstance().getUtilityJson(t.utilityId))||void 0===i?void 0:i.url})),n=yield Promise.all(o.map((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t)))),r=new Set;for(let e=0;e<o.length;e++)r.add(n[e].owningSystemUrl||o[e]);const a=[...r],l=Object.keys(G||{});for(const e of a){if(G[e]&&G[e]!==(null==i?void 0:i[e]))return void N(Math.random());for(const t of l)if(e.includes(t)&&G[t]!==(null==i?void 0:i[t]))return void N(Math.random())}}))}()}),[null==c?void 0:c.useUtilities,G]),M((()=>{function t(){var e,t,i;if(null===(t=null===(e=J.current)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map){const e=J.current.view.map.findLayerById(m);e&&L.view.map.remove(e),J.current.destroy()}V.current&&(V.current.innerHTML="");try{const e=null===(i=document.querySelector("calcite-panel.esri-save-layer"))||void 0===i?void 0:i.parentElement;e&&"CALCITE-POPOVER"===e.tagName.toUpperCase()&&document.body.removeChild(e)}catch(e){}}return $&&(null==L?void 0:L.view)&&V.current?function(){var i,r;b(this,void 0,void 0,(function*(){t();const d=D(null==S?void 0:S.useUtility),g=e.proxyUtils.getWhetherUseProxy()&&e.proxyUtils.getProxyUrl(d)||d,f=yield function(t,i){var o,n,r;return b(this,void 0,void 0,(function*(){const l=Object.assign({},a),s=(null===(o=null==t?void 0:t.generalConfig)||void 0===o?void 0:o.hint)||i;if(s&&(l.allPlaceholder=s),"number"==typeof(null===(n=null==t?void 0:t.suggestionConfig)||void 0===n?void 0:n.maxSuggestions)&&(l.maxSuggestions=t.suggestionConfig.maxSuggestions),"boolean"==typeof(null===(r=null==t?void 0:t.suggestionConfig)||void 0===r?void 0:r.isUseCurrentLoation)&&(l.locationEnabled=t.suggestionConfig.isUseCurrentLoation),Array.isArray(null==t?void 0:t.dataConfig)){const o=null==t?void 0:t.dataConfig.map((t=>b(this,void 0,void 0,(function*(){const o=D(t.useUtility),n={url:e.proxyUtils.getWhetherUseProxy()&&e.proxyUtils.getProxyUrl(o)||o,name:t.label,placeholder:t.hint||i};return Promise.resolve(n)}))));yield Promise.all(o).then((e=>{l.sources=e}))}return Promise.resolve(l)}))}(h,z),p=document.createElement("div");p.className="directions-container",C&&(p.className+=" dark-theme"),V.current.innerHTML="",V.current.appendChild(p);const y=new n.default({id:m,url:g});null===(r=null===(i=null==L?void 0:L.view)||void 0===i?void 0:i.map)||void 0===r||r.add(y),J.current=new o.default({id:m,layer:y,container:p,view:null==L?void 0:L.view,searchProperties:f}),J.current.viewModel.routeParameters.returnRoutes=!0,J.current.viewModel.routeParameters.returnDirections=!0,J.current.viewModel.routeParameters.returnStops=!0,Q(),R(m),W.current=J.current.watch("lastRoute",(()=>{c.autoHeight&&(V.current.style.maxHeight="750px"),J.current.lastRoute?function(t,i){var o,n,r;b(this,void 0,void 0,(function*(){try{const a=yield e.DataSourceManager.getInstance().createDataSource(l(t)),c=yield e.DataSourceManager.getInstance().createDataSource(v(t)),d=yield e.DataSourceManager.getInstance().createDataSource(s(t)),g=yield e.DataSourceManager.getInstance().createDataSource(u(t));yield T(a,"point",E(null===(o=i.stops)||void 0===o?void 0:o.toArray())),yield T(c,"polyline",E(i.routeInfo?[i.routeInfo]:[])),yield T(d,"point",E(null===(n=i.directionPoints)||void 0===n?void 0:n.toArray())),yield T(g,"polyline",E(null===(r=i.directionLines)||void 0===r?void 0:r.toArray())),A(a),A(c),A(d),A(g)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}(m,J.current.lastRoute):R(m)}))}))}():t(),()=>{var e;null===(e=W.current)||void 0===e||e.remove(),t()}}),[m,null==L?void 0:L.view,h,null==S?void 0:S.useUtility,z,$,C,c.autoHeight,Q,F]),(0,e.jsx)("div",{className:"widget-directions jimu-widget"},$?(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:j,onActiveViewChange:q}):(0,e.jsx)(i.WidgetPlaceholder,{widgetId:m,icon:p(),message:H("_widgetLabel")}),(0,e.jsx)("div",{ref:V,css:P}),(0,e.jsx)(x,{useUtilities:c.useUtilities}))},P=e.css`
  width: 100% !important;
  height: 100% !important;
  .directions-container{
    width: 100% !important;
    height: 100% !important;
    .esri-search{
      .esri-search__container{
        .esri-search__sources-button{
          z-index: 0;
          border-top: none;
          border-right: solid 1px var(--light-300);
          border-bottom: none;
          border-left: none;
          margin-right: 1px;
          margin-bottom: 2px;
        }
        .esri-search__input-container{
          margin: auto;
          .esri-search__clear-button{
            z-index: 0;
            right: 4px;
          }
        }
      }
      .esri-search--multiple-sources {
        .esri-search__sources-button {
          border-right: inherit;
        }
        .esri-search__input {
          border: 1px solid #959595;
        }
      }
    }
    .esri-directions__panel-content{
      padding: 0 0 20px 0;
    }
    .esri-directions__add-stop-button{
      --calcite-ui-text-1: var(--dark);
    }
    &.dark-theme img.esri-directions__maneuver-icon{
      filter: invert(100%);
    }
  }
`;function D(t){var i;return t?null===(i=e.UtilityManager.getInstance().getUtilityJson(t.utilityId))||void 0===i?void 0:i.url:null}function R(t){return b(this,void 0,void 0,(function*(){try{const i=yield e.DataSourceManager.getInstance().createDataSource(l(t)),o=yield e.DataSourceManager.getInstance().createDataSource(v(t)),n=yield e.DataSourceManager.getInstance().createDataSource(s(t)),r=yield e.DataSourceManager.getInstance().createDataSource(u(t));j(i),j(o),j(n),j(r)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}function j(t){t&&(t.setStatus(e.DataSourceStatus.NotReady),t.setCountStatus(e.DataSourceStatus.NotReady))}function A(t){t&&(t.setStatus(e.DataSourceStatus.Unloaded),t.setCountStatus(e.DataSourceStatus.Unloaded))}function T(t,i,o){return b(this,void 0,void 0,(function*(){if(!t)return;const n=t.getSchema().fields[t.getIdField()],r=e.dataSourceUtils.changeJimuFieldsToJSAPIFields(t.getSchema().fields,n);yield t.updateSourceByFeatures(o,r,null==n?void 0:n.name,{id:t.id,geometryType:i})}))}function E(e){return e?e.map((e=>null==e?void 0:e.toGraphic())).filter((e=>!!e)):[]}function L(e){c.p=e}})(),d})())}}}));