System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime"],(function(e,t){var o={},i={},s={};return{setters:[function(e){o.AnimationContext=e.AnimationContext,o.AppMode=e.AppMode,o.ExpressionResolverComponent=e.ExpressionResolverComponent,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.LinkType=e.LinkType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ReactResizeDetector=e.ReactResizeDetector,o.TransitionContainer=e.TransitionContainer,o.TransitionDirection=e.TransitionDirection,o.TransitionType=e.TransitionType,o.appActions=e.appActions,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.getAppStore=e.getAppStore,o.getNextAnimationId=e.getNextAnimationId,o.hooks=e.hooks,o.jimuHistory=e.jimuHistory,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){i.LinkTip=e.LinkTip,i.WidgetPlaceholder=e.WidgetPlaceholder,i._Link=e._Link,i.hooks=e.hooks,i.styleUtils=e.styleUtils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils}],execute:function(){e((()=>{var e={90858:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#FFF" fill-rule="nonzero" d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4M2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4"></path></svg>'},41235:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2zm.951-4v-2H5.817l-.578-1h8.81v3z" clip-rule="evenodd"></path></svg>'},60397:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11z" clip-rule="evenodd"></path></svg>'},48891:e=>{"use strict";e.exports=o},74758:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=i}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{Widget:()=>A,__set_webpack_public_path__:()=>P,default:()=>R});var e,t,o,i,s,l=n(48891),r=n(30726);!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(e||(e={})),l.TransitionType.None,l.TransitionDirection.Horizontal,function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10"}(t||(t={})),function(e){e.Default="DEFAULT",e.Hover="HOVER"}(o||(o={})),function(e){e.None="NONE",e.Default="DEFAULT",e.Hover="HOVER"}(i||(i={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(s||(s={}));var d=n(74758);class u extends l.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:t}=this.props,o=this.checkIsBackgroundTransparent(e);return l.css`
      &,
      .animation-list {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      .card-editor-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      ${"&.card-"+t} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent !important;
      }
      .card-link {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      .clear-background:focus {
        outline: none;
      }
      .surface-1 {
        border: none !important;
        background: ${o&&"none !important"};
      }
      .jimu-link {
        text-align: left;
      }
      ${"&.card-"+t}:hover {
      }
    `}}checkIsBackgroundTransparent(e){var t,o,i;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(i=null===(o=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===o?void 0:o.background)||void 0===i?void 0:i.color)}}var c=n(60397),p=n.n(c);const h=e=>{const t=window.SVG,{className:o}=e,i=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o}(e,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",o);return t?l.React.createElement(t,Object.assign({className:s,src:p()},i)):l.React.createElement("svg",Object.assign({className:s},i))};var v=n(41235),g=n.n(v);const y=e=>{const t=window.SVG,{className:o}=e,i=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o}(e,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",o);return t?l.React.createElement(t,Object.assign({className:s,src:g()},i)):l.React.createElement("svg",Object.assign({className:s},i))},f=[0,5],m=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],I=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}],S=l.ReactRedux.connect(((e,t)=>{var o;const{appMode:i}=t;return window.jimuConfig.isInBuilder&&i!==l.AppMode.Run?{selection:t.selectionIsInCard&&(null===(o=null==e?void 0:e.appRuntimeInfo)||void 0===o?void 0:o.selection)}:{selection:void 0}}))(class extends u{constructor(t){super(t),this.lastResizeCall=null,this.handleCopyTo=(e,t,o,i)=>{if(!o)return;const{layouts:s,builderSupportModules:n,browserSizeMode:a,builderStatus:l}=this.props,r=n.jimuForBuilderLib;let u=r.getAppConfigAction(),c=u.appConfig;const p=d.searchUtils.findLayoutId(s[l],a,c.mainSizeMode),h=d.searchUtils.findLayoutId(s[t],a,c.mainSizeMode);if(i){const e=n.widgetModules.searchUtils,t=o.widgetId,i=c.widgets[t].parent[a],s=i.find((e=>e.layoutId===p)),l=i.find((e=>e.layoutId===h)),r=e.findLayoutItem(c,s);u.editLayoutItemProperty(l,"bbox",r.bbox).editLayoutItemProperty(l,"setting",r.setting)}else{const e=r.LayoutServiceProvider.getService(c,h).createBlankItem(c,h);c=e[0];const t=e[1],i={layoutId:h,layoutItemId:t},s=d.searchUtils.findLayoutItem(c,{layoutId:p,layoutItemId:o.id});c=r.widgetService.addParent(c,o.widgetId,i,a),u=r.getAppConfigAction(c),u.editLayoutItemProperty(i,"bbox",s.bbox).editLayoutItemProperty(i,"setting",s.setting).editLayoutItemProperty(i,"type",s.type).editLayoutItemProperty(i,"widgetId",s.widgetId).adjustOrderOfItem(i,-1)}this.setState({widgetsUpdate:Symbol()}),u.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,t)=>{const{dispatch:o,widgetId:i}=this.props;o(l.appActions.widgetStatePropChange(i,e,t))},this.toggleStatus=e=>{var t;const{cardConfigs:i}=this.props,s=null===(t=null==i?void 0:i.HOVER)||void 0===t?void 0:t.enable,n=e===o.Hover;let{previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u}=this.state;const c=e===o.Default&&1===r;(s||c)&&(a=n?0:1,r=n?1:0,d=n?(0,l.getNextAnimationId)():null,u=n?null:(0,l.getNextAnimationId)()),this.setState({previousIndex:a,currentIndex:r,hoverPlayId:d,regularPlayId:u})},this.handleBreakLink=e=>{const{builderSupportModules:t,browserSizeMode:o,selection:i,builderStatus:s,dispatch:n,widgetId:a}=this.props,r=t.jimuForBuilderLib;let u=r.getAppConfigAction();const c=u.appConfig,p=d.searchUtils.findLayoutItem(c,i);if(!p)return;const h=c.widgets[a].layouts[s][o],v=u.duplicateLayoutItemInSameLayout({layoutId:h,layoutItemId:p.id});u.editLayoutItemProperty({layoutId:i.layoutId,layoutItemId:v},"bbox",p.bbox).removeLayoutItem({layoutId:h,layoutItemId:p.id},!1);const g=d.searchUtils.findLayoutItem(u.appConfig,{layoutId:h,layoutItemId:v}),y=new r.ContentServiceWrapper(u.appConfig,g);y.removeSizeModeParent(o),y.addParent({layoutId:h,layoutItemId:v},o),u=r.getAppConfigAction(y.getConfig()),i.layoutId===h&&i.layoutItemId===p.id&&n(l.appActions.selectionChanged(null));const f=u.appConfig.layouts[h].content,m=Object.keys(f)[Object.keys(f).length-1];if(m){const e=f[m];n(l.appActions.selectionChanged({layoutId:h,layoutItemId:e.id}))}u.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.initParentOfNewWidgetAfterIsolate=(e,t)=>{const{browserSizeMode:o}=this.props,i=e.parent[o],s=null==i?void 0:i.filter((e=>e.layoutId===t));return e.setIn(["parent",o],s)},this.getCopyDropdownItems=t=>{const{cardConfigs:i,layouts:s,browserSizeMode:n,selection:a,builderStatus:r,builderSupportModules:u}=this.props,c=u.jimuForBuilderLib.getAppConfigAction().appConfig,p=d.searchUtils.findLayoutItem(c,a);if(!a||!p||!window.jimuConfig.isInBuilder)return{items:(0,l.Immutable)([]),title:""};const h=[];let v="",g=!0,y=!0;const f=(e,t)=>u.widgetModules.searchUtils.getContentsInLayoutWithRecrusiveLayouts(c,e,l.LayoutItemType.Widget,n).indexOf(t)>-1;return r===o.Default?((()=>{const{cardLayout:t}=this.props;if(i[o.Hover]&&t!==e.AUTO){const e=d.searchUtils.findLayoutId(s[o.Hover],n,c.mainSizeMode);f(e,c.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(y=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,o.Hover,p,y)}})}})(),v=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):r===o.Hover&&((()=>{const{cardLayout:t}=this.props;if(t!==e.AUTO){const e=d.searchUtils.findLayoutId(s[o.Default],n,c.mainSizeMode);f(e,c.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(g=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("default").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,o.Default,p,g)}})}})(),v=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()})),t?h.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):v=this.formatMessage("isolate"),{items:(0,l.Immutable)(h),title:v}},this.getCardToolsStyle=e=>l.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{builderSupportModules:e,selectionIsCard:t,selectionIsInCard:i,appMode:s,hideCardTool:n,cardConfigs:a}=this.props,{BuilderPopper:r,GLOBAL_RESIZING_CLASS_NAME:d,GLOBAL_H5_DRAGGING_CLASS_NAME:u,GLOBAL_DRAGGING_CLASS_NAME:c}=e.widgetModules;let p=!0;return(!i&&!t||s===l.AppMode.Run||n)&&(p=!1),this.props.isEditing&&a[o.Hover].enable&&(0,l.jsx)(r,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:l.css`
            .${c} &,
            .${d} &,
            .${u} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:f,modifiers:m,open:p},this.getCardMenuElement())},this.getCardMenuElement=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:e,widgetId:t,builderSupportModules:i,browserSizeMode:s,builderStatus:n,selectionIsCard:a}=this.props,r=i.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:d,BuilderDropDown:u,BuilderButton:c,withBuilderTheme:p}=i.widgetModules,v=a,g=!v&&e&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(r,e,t,s).length>1,{items:f,title:m}=this.getCopyDropdownItems(g),S=f&&f.length>0,b=p((e=>(0,l.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e)},(0,l.jsx)(c,{active:n===o.Default,onClick:e=>{this.handleBuilderStatusChange(e,o.Default)}},this.formatMessage("default")),(0,l.jsx)(c,{active:n===o.Hover,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,o.Hover)}},this.formatMessage("hover")),!v&&(S||g)&&(0,l.jsx)(u,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:m,toggleType:"default",direction:"left",toggleContent:e=>g?(0,l.jsx)(h,{size:16}):(0,l.jsx)(y,{size:16}),modifiers:I,items:f}))));return(0,l.jsx)(b,null)},this.getEditorStyle=()=>l.css`
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{const{cardConfigs:t,LayoutEntry:i,layouts:s,browserSizeMode:n,cardLayout:a}=this.props,{hoverPlayId:d,regularPlayId:u}=this.state,c=s[o.Default],p=a===e.AUTO?c:s[o.Hover],h=t[o.Default].backgroundStyle.setIn(["boxShadow","color"],"transparent"),v=t[o.Hover].backgroundStyle.setIn(["boxShadow","color"],"transparent"),g=t.transitionInfo,y=[],f=Object.assign({},r.styleUtils.toCSSStyle(h||{})),m=(0,l.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.regularLayoutRef,key:o.Default},(0,l.jsx)("div",{className:"w-100, h-100 animation-list",style:f},(0,l.jsx)(l.AnimationContext.Provider,{value:{setting:(null==g?void 0:g.oneByOneEffect)||null,playId:u,oid:c[n]}},(0,l.jsx)(i,{className:"h-100",isRepeat:!0,layouts:c,isInWidget:!0}))));if(y.push(m),!t[o.Hover].enable)return y;const I=Object.assign({},r.styleUtils.toCSSStyle(v||{})),S=a===e.AUTO&&t[o.Hover].enable,b=(0,l.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.hoverLayoutRef,key:o.Hover},(0,l.jsx)("div",{className:"w-100, h-100 animation-list position-relative",style:I},(0,l.jsx)(l.AnimationContext.Provider,{value:{setting:(null==g?void 0:g.oneByOneEffect)||null,playId:d,oid:null==p?void 0:p[n]}},(0,l.jsx)(i,{className:"h-100",isRepeat:!0,layouts:p,isInWidget:!0})),S&&(0,l.jsx)("div",{className:"card-editor-mask position-absolute"})));return y.push(b),y},this.getCardStyle=()=>{var e,t,i,s;const{builderStatus:n,cardConfigs:a}=this.props,l=a[o.Hover].enable?n:o.Default,d={boxShadow:null===(t=null===(e=a[l])||void 0===e?void 0:e.backgroundStyle)||void 0===t?void 0:t.boxShadow,borderRadius:null===(s=null===(i=a[l])||void 0===i?void 0:i.backgroundStyle)||void 0===s?void 0:s.borderRadius};return Object.assign({},r.styleUtils.toCSSStyle(d))},this.state={didMount:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null,widgetsUpdate:null},this.regularLayoutRef=l.React.createRef(),this.hoverLayoutRef=l.React.createRef(),this.layoutRef=l.React.createRef(),this.isUpdateFirst=!0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(e){var t,i;const{cardConfigs:s,builderStatus:n}=this.props,a=e.cardConfigs,l=(null===(t=null==a?void 0:a.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(i=null==s?void 0:s.transitionInfo)||void 0===i?void 0:i.previewId),r=e.builderStatus&&e.builderStatus!==n&&!this.isUpdateFirst,d=a[o.Hover].enable!==s[o.Hover].enable;(!l||r||d)&&this.toggleStatus(n),this.isUpdateFirst&&(this.isUpdateFirst=!1)}handleBuilderStatusChange(e,t){var o;this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t),null===(o=null==this?void 0:this.props)||void 0===o||o.selectSelf(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var e,t;const{cardConfigs:o,widgetId:i,isShowMask:s,builderStatus:n,selectionIsCard:a,selectionIsInCard:r}=this.props,{didMount:d,previousIndex:u,currentIndex:c}=this.state,p=o.transitionInfo,h=`card-${i}`,v=(a||r?null==p?void 0:p.previewId:null)||null;return(0,l.jsx)("div",{css:this.getStyle(n),style:this.getCardStyle(),className:h},d&&this.renderCardTools(),(0,l.jsx)("div",{className:"w-100, h-100",ref:this.layoutRef},(0,l.jsx)(l.TransitionContainer,{previousIndex:u,currentIndex:c,transitionType:null===(e=null==p?void 0:p.transition)||void 0===e?void 0:e.type,direction:null===(t=null==p?void 0:p.transition)||void 0===t?void 0:t.direction,playId:d?v:null,withOneByOne:!!(null==p?void 0:p.oneByOneEffect)},this.renderCardEditor())),s&&(0,l.jsx)("div",{className:"edit-mask position-absolute"}))}}),{useRef:b,useState:w}=l.React,C=e=>{var t;const{useDataSources:o,appMode:i,linkParam:s,widgetId:n,queryObject:a,children:d,changeIsCanClickLink:u}=e,c=b(null),p=b(null),h=l.React.useContext(l.jimuHistory.HistoryContext),[v,g]=w(!1),[y,f]=w(null),m=r.hooks.useApplyLinkResult(),I=()=>{clearTimeout(p.current),g(!0),setTimeout((()=>{g(!1)}),3e3)},S=()=>{var e,t;let o=!1;return(null==s?void 0:s.linkType)===l.LinkType.WebAddress&&(s.value?o=l.urlUtils.isAbsoluteUrl(s.value):(null===(e=null==s?void 0:s.expression)||void 0===e?void 0:e.name)&&(o=l.urlUtils.isAbsoluteUrl(null===(t=null==s?void 0:s.expression)||void 0===t?void 0:t.name))),o},C=(e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),i=null==e?void 0:e.role,s=e&&e.tagName||"",n="button"===s.toLowerCase()||"button"===i,a="a"===s.toLowerCase()||"linkClick"===t.exbEventType,l="input"===s.toLowerCase()||"input"===i;return n||a||!!o&&o>-1||l},x=l.css`
    .list-clear-background {
      background: transparent !important;
    }
    .list-link {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
    }
  `,L=l.hooks.useEventCallback((()=>{const e=null==s?void 0:s.openType,t={linkType:null==s?void 0:s.linkType,value:null==s?void 0:s.value};let o=a;return(null==s?void 0:s.linkType)===l.LinkType.WebAddress&&(t.value=y||(null==t?void 0:t.value),o=void 0),{queryObject:o,target:e,linkTo:t}})),j=e=>{e.stopPropagation()};return(0,l.jsx)("div",{className:"w-100 h-100",onClick:e=>{if(u&&!u())return;const t=window.jimuConfig.isInBuilder;if(i===l.AppMode.Design&&t)return!1;const o=(e=>{const t=e.target;return C(t,e)||C(null==t?void 0:t.parentNode,e)})(e),n=S();if(!o&&(null==s?void 0:s.linkType)&&(null==s?void 0:s.linkType)!==l.LinkType.None){const o=L();if(n){if(t)return I(),!1;"_self"===s.openType?window.location.href=o.linkTo.value:o.linkTo.value&&window.open(o.linkTo.value,s.openType)}else if((null==s?void 0:s.linkType)===l.LinkType.Block)c.current.click();else{if(t&&(null==s?void 0:s.linkType)===l.LinkType.PrintPreview)return I(),!1;m({evt:e,linkTo:o.linkTo,target:o.target,replace:!1,queryObject:o.queryObject})}}"linkClick"===e.exbEventType&&delete e.exbEventType},css:x},(()=>{var e;const t=L();return(null===(e=null==t?void 0:t.linkTo)||void 0===e?void 0:e.linkType)&&(0,l.jsx)(r._Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:c,to:t.linkTo,target:t.target,queryObject:t.queryObject,onClick:j})})(),d,o&&(0,l.jsx)(l.ExpressionResolverComponent,{useDataSources:o,expression:null==s?void 0:s.expression,onChange:e=>{e.isSuccessful?f(e.value):f("")},widgetId:n}),window.jimuConfig.isInBuilder&&(S()||(null==s?void 0:s.linkType)===l.LinkType.PrintPreview)&&(0,l.jsx)(r.LinkTip,{reference:null===(t=c.current)||void 0===t?void 0:t.id,open:v,href:(()=>{const e=L();return l.urlUtils.getHrefFromLinkTo(e.linkTo,a,h&&h.location)||""})()}))},{useState:x,useRef:L,useEffect:j}=l.React,k=function(t){var i,s;const n=L(!1),{cardConfigs:a,layouts:u,appMode:c,linkParam:p,browserSizeMode:h,cardLayout:v,hoverPlayId:g,regularPlayId:y,previewId:f,previousIndex:m,currentIndex:I,queryObject:S}=t,[b,w]=x(null),[k,T]=x(!1),[M,A]=x(!1);j((()=>{var e,t;w(null==a?void 0:a.transitionInfo),T(null===(e=null==a?void 0:a.HOVER)||void 0===e?void 0:e.enable),A((null===(t=window.jimuConfig)||void 0===t?void 0:t.isInBuilder)||!1)}),[a]),j((()=>{n.current=!0}),[]);const R=l.hooks.useEventCallback((()=>{var t,i;const s=[];let n,f,m,I;M&&c!==l.AppMode.Run?(f=P(o.Default),n=u[o.Default],k&&(I=P(o.Hover),m=v===e.AUTO?n:u[o.Hover])):(n=u[o.Default],f=P(o.Default),k&&(m=v===e.AUTO?n:u[o.Hover],I=P(o.Hover)));const S=Object.assign({},r.styleUtils.toCSSStyle(f||{})),b=(null==p?void 0:p.linkType)&&(null==p?void 0:p.linkType)!==l.LinkType.None,w=(0,l.jsx)("div",{className:(0,l.classNames)("card-content d-flex surface-1",b?"card-link":""),tabIndex:b?-1:1,key:o.Default},(0,l.jsx)("div",{className:"w-100 animation-list",style:S},(0,l.jsx)("div",{className:"d-flex w-100 h-100"},(0,l.jsx)(l.AnimationContext.Provider,{value:{setting:(null===(t=null==a?void 0:a.transitionInfo)||void 0===t?void 0:t.oneByOneEffect)||null,playId:y,oid:null==n?void 0:n[h]}},(0,l.jsx)(d.LayoutEntry,{layouts:n})))));if(s.push(w),k){const e=Object.assign({},r.styleUtils.toCSSStyle(I||{})),t=(0,l.jsx)("div",{className:(0,l.classNames)("card-content d-flex surface-1 w-100 h-100",b?"card-link":""),key:o.Hover},(0,l.jsx)("div",{className:"w-100 h-100 animation-list",style:e},(0,l.jsx)("div",{className:"d-flex w-100 h-100"},(0,l.jsx)(l.AnimationContext.Provider,{value:{setting:(null===(i=null==a?void 0:a.transitionInfo)||void 0===i?void 0:i.oneByOneEffect)||null,playId:g,oid:(null==m?void 0:m[h])||null}},(0,l.jsx)(d.LayoutEntry,{layouts:m})))));s.push(t)}return s})),P=e=>{const t=a[e].backgroundStyle;return(null==t?void 0:t.boxShadow)?t.setIn(["boxShadow","color"],"transparent"):t};return(0,l.jsx)(C,{linkParam:p,appMode:c,queryObject:S},(0,l.jsx)(l.TransitionContainer,{previousIndex:m,currentIndex:I,transitionType:null===(i=null==b?void 0:b.transition)||void 0===i?void 0:i.type,direction:null===(s=null==b?void 0:b.transition)||void 0===s?void 0:s.direction,playId:n.current?f:null,withOneByOne:!!(null==b?void 0:b.oneByOneEffect)},R()))};class T extends u{constructor(e){super(e),this.onMouse=(e,t=!1)=>{var o;const{cardConfigs:i}=this.props,s=null===(o=null==i?void 0:i.HOVER)||void 0===o?void 0:o.enable;let{previousIndex:n,currentIndex:a,hoverPlayId:r,regularPlayId:d}=this.state;s&&(n=t?0:1,a=t?1:0,r=t?(0,l.getNextAnimationId)():null,d=t?null:(0,l.getNextAnimationId)()),this.setState({isHover:t,previousIndex:n,currentIndex:a,hoverPlayId:r,regularPlayId:d})},this.getCardShadowStyle=()=>{var e,t;const{cardConfigs:i}=this.props,{isHover:s}=this.state,n=s&&i[o.Hover].enable?o.Hover:o.Default,a={boxShadow:null===(e=i[n].backgroundStyle)||void 0===e?void 0:e.boxShadow,borderRadius:null===(t=i[n].backgroundStyle)||void 0===t?void 0:t.borderRadius};return Object.assign({},r.styleUtils.toCSSStyle(a))},this.state={url:"",isHover:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null},this.regularLayoutRef=l.React.createRef(),this.hoverLayoutRef=l.React.createRef(),this.linkRef=l.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(e){var t,o;const i=this.props.cardConfigs,{cardConfigs:s}=e;(null===(t=null==i?void 0:i.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(o=null==s?void 0:s.transitionInfo)||void 0===o?void 0:o.previewId)||this.setState({hoverPlayId:(0,l.getNextAnimationId)(),regularPlayId:(0,l.getNextAnimationId)()})}render(){const{widgetId:e,cardConfigs:t,linkParam:i,queryObject:s,layouts:n,appMode:a,browserSizeMode:r,cardLayout:d}=this.props,{previousIndex:u,currentIndex:c,regularPlayId:p,hoverPlayId:h}=this.state,v=t.transitionInfo,g=`card-${e}`,y=(null==v?void 0:v.previewId)||null,f=0===c?o.Default:o.Hover;return(0,l.jsx)("div",{css:this.getStyle(f),style:this.getCardShadowStyle(),className:g,onMouseLeave:e=>{this.onMouse(e,!1)},onMouseEnter:e=>{this.onMouse(e,!0)}},(0,l.jsx)(k,{linkParam:i,queryObject:s,cardConfigs:t,layouts:n,appMode:a,browserSizeMode:r,hoverPlayId:h,regularPlayId:p,previousIndex:u,currentIndex:c,previewId:y,cardLayout:d}))}}const M={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class A extends l.React.PureComponent{constructor(e){super(e),this.setListParentSizeInWidgetState=()=>{const{browserSizeMode:e,id:t,parentSize:o,layoutId:i}=this.props,s=(0,l.getAppStore)().getState().appConfig,n=l.utils.findViewportSize(s,e),a=`div.layout[data-layoutid=${i}]`,r=document.querySelector(a),d={width:(null==r?void 0:r.clientWidth)||n.width,height:(null==r?void 0:r.clientHeight)||n.height};o&&o.height===d.height&&o.width===d.width||this.props.dispatch(l.appActions.widgetStatePropChange(t,"parentSize",d))},this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:t}=this.props;this.props.dispatch(l.appActions.widgetStatePropChange(e,"selectionIsInSelf",t))},this.setSettinglayout=()=>{const{layoutId:e,layoutItemId:t,id:o,selectionIsSelf:i}=this.props,{isSetlayout:s}=this.state;e&&o&&t&&!s&&i&&(this.props.dispatch(l.appActions.widgetStatePropChange(o,"layoutInfo",{layoutId:e,layoutItemId:t})),this.setState({isSetlayout:!0}))},this.onResize=(e,t)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props;e&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},M),l.defaultMessages)[e]},t),this.editStatus=(e,t)=>{const{dispatch:o,id:i}=this.props;o(l.appActions.widgetStatePropChange(i,e,t))},this.editWidgetConfig=e=>{window.jimuConfig.isInBuilder&&this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.isEditing=()=>{const{appMode:e,config:t,selectionIsSelf:o,selectionIsInSelf:i}=this.props;return!!window.jimuConfig.isInBuilder&&(o||i)&&window.jimuConfig.isInBuilder&&e!==l.AppMode.Run&&t.isItemStyleConfirm},this.checkIsShowMask=()=>{const{appMode:e,config:t}=this.props;return!(!window.jimuConfig.isInBuilder||window.jimuConfig.isInBuilder&&e!==l.AppMode.Run&&t.isItemStyleConfirm)},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.getAppConfig=()=>(0,l.getAppStore)().getState().appConfig,this.getStyle=e=>{const{id:t}=this.props;return l.css`
      ${"&.card-widget-"+t} {
        overflow: visible;
        background-color: transparent;
        border: ${l.polished.rem(0)} solid
          ${l.polished.rgba(e.colors.black,window.jimuConfig.isInBuilder&&this.isEditing()?.2:0)};
        width: 100%;
        height: 100%;
      }
    `},this.getCardProps=()=>{const{config:e,selectionIsInSelf:t,selectionIsSelf:o,builderStatus:i,appMode:s,queryObject:n}=this.props,a=window.jimuConfig.isInBuilder&&s===l.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:o,selectionIsInCard:t,isEditing:this.isEditing(),isShowMask:this.checkIsShowMask(),builderStatus:i,selectSelf:this.selectSelf}:{linkParam:e.linkParam,queryObject:n};return Object.assign(Object.assign({},this.getOtherProps()),a)},this.getOtherProps=()=>{const{config:e,theme:t,id:o,appMode:i,builderSupportModules:s,layouts:n,browserSizeMode:a,dispatch:l,isRTL:r,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:a,isRTL:r,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:l,widgetId:o,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:i,theme:t,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:e,isHeightAuto:d,isWidthAuto:u,cardLayout:null==e?void 0:e.cardLayout}},this.cardRender=()=>{const e=this.getCardProps(),{appMode:t}=this.props,o=window.jimuConfig.isInBuilder&&t===l.AppMode.Design?S:T;return(0,l.jsx)(o,Object.assign({},e))};const t={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?t.LayoutEntry=this.props.builderSupportModules.LayoutEntry:t.LayoutEntry=d.LayoutEntry,this.state=t,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=l.lodash.debounce(((e,t)=>{this.onResize(e,t)}),200)}componentDidUpdate(e,t){var i;const{appMode:s,selectionStatus:n,builderStatus:a,left:r,top:d}=this.props;s!==l.AppMode.Run&&n!==a&&n&&this.editBuilderAndSettingStatus(n),e.appMode!==s&&s===l.AppMode.Run&&this.editBuilderAndSettingStatus(o.Default),(null==e?void 0:e.selectionIsInSelf)!==(null===(i=this.props)||void 0===i?void 0:i.selectionIsInSelf)&&this.setSelectionStatus(),d===e.top&&r===e.left||this.updateCardToolPosition(),this.setSettinglayout(),this.setListParentSizeInWidgetState()}selectSelf(){if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:e,layoutItemId:t}=this.props,o={layoutId:e,layoutItemId:t};this.props.dispatch(l.appActions.selectionChanged(o))}render(){const{config:e,id:t}=this.props,o=(0,l.classNames)("jimu-widget","widget-card","card-widget-"+t);return e.itemStyle?(0,l.jsx)("div",{className:o,css:this.getStyle(this.props.theme)},this.cardRender(),(0,l.jsx)(l.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})):(0,l.jsx)(r.WidgetPlaceholder,{widgetId:this.props.id,icon:n(90858),message:this.formatMessage("placeHolderTip")})}}A.mapExtraStateProps=(e,t)=>{var i,s,n,a,l,r,u,c,p,h,v,g,y,f,m;const I=e&&e.appConfig,{layouts:S,layoutId:b,layoutItemId:w,builderSupportModules:C,id:x}=t,L=null==e?void 0:e.browserSizeMode,j=(null==e?void 0:e.widgetsState[t.id])&&(null===(i=null==e?void 0:e.widgetsState[t.id])||void 0===i?void 0:i.builderStatus)||o.Default,k=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,T=k&&C&&C.widgetModules&&C.widgetModules.selectionInCard(k,x,I,!1);let M;T&&(M=Object.keys(S).find((e=>d.searchUtils.findLayoutId(S[e],L,I.mainSizeMode)===k.layoutId)));const A=null===(s=I.layouts)||void 0===s?void 0:s[b],R=null===(a=null===(n=null==A?void 0:A.content)||void 0===n?void 0:n[w])||void 0===a?void 0:a.setting,P=(null===(l=null==R?void 0:R.autoProps)||void 0===l?void 0:l.height)===d.LayoutItemSizeModes.Auto||!0===(null===(r=null==R?void 0:R.autoProps)||void 0===r?void 0:r.height),O=(null===(u=null==R?void 0:R.autoProps)||void 0===u?void 0:u.width)===d.LayoutItemSizeModes.Auto||!0===(null===(c=null==R?void 0:R.autoProps)||void 0===c?void 0:c.width);let E;if(window.jimuConfig.isInBuilder){const e=null===(g=null===(v=null===(h=null===(p=I.layouts)||void 0===p?void 0:p[b])||void 0===h?void 0:h.content)||void 0===v?void 0:v[w])||void 0===g?void 0:g.bbox;E=e&&{left:e.left,top:e.top}}return{selectionIsSelf:(null==k?void 0:k.layoutId)===b&&(null==k?void 0:k.layoutItemId)===w,selectionIsInSelf:T,selectionStatus:M,appMode:null===(y=null==e?void 0:e.appRuntimeInfo)||void 0===y?void 0:y.appMode,browserSizeMode:null==e?void 0:e.browserSizeMode,builderStatus:j,isRTL:null===(f=null==e?void 0:e.appContext)||void 0===f?void 0:f.isRTL,left:E&&E.left,top:E&&E.top,isHeightAuto:P,isWidthAuto:O,queryObject:e.queryObject,parentSize:(null===(m=e.widgetsState[t.id])||void 0===m?void 0:m.parentSize)||null}};const R=A;function P(e){n.p=e}})(),a})())}}}));